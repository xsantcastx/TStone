<nav class="fixed inset-x-0 top-0 z-[90] transition-all duration-300" 
     [class.bg-transparent]="!scrolled"
     [class.bg-white/95]="scrolled"
     [class.backdrop-blur-md]="scrolled"
     [class.border-b]="scrolled"
     [class.border-gray-100]="scrolled"
     [class.text-white]="!scrolled"
     [class.text-neutral-900]="scrolled">
  <div class="max-w-7xl mx-auto px-6">
    <div class="flex items-center justify-between h-20">
      
      <!-- Logo -->
      <a routerLink="/" class="flex items-center gap-3 group" (click)="cerrarMenu()">
        <img [src]="logoSrc" 
             alt="TopStone Logo" 
             class="h-10 w-auto transition-opacity duration-300 group-hover:opacity-90"/>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-8"
           [class.text-white]="!scrolled"
           [class.text-neutral-900]="scrolled">
        <!-- Home -->
        <a routerLink="/" 
           routerLinkActive="text-ts-accent" 
           [routerLinkActiveOptions]="{exact: true}"
           class="font-medium hover:text-ts-accent transition-colors px-3 py-2">
          Inicio
        </a>
        
        <!-- Productos with CSS-only Mega Menu -->
        <!-- Productos + Mega menu -->
        <div class="relative group">
          <!-- Trigger (still navigates to /productos) -->
          <a routerLink="/productos"
             class="relative inline-flex items-center gap-1 hover:text-[var(--ts-accent)]
                    before:content-[''] before:absolute before:left-0 before:top-full
                    before:w-full before:h-5">
            Productos <span aria-hidden>▾</span>
          </a>

          <!-- Panel -->
          <div
            class="pointer-events-none group-hover:pointer-events-auto
                   invisible opacity-0 group-hover:visible group-hover:opacity-100
                   transition-opacity duration-150
                   absolute left-1/2 -translate-x-1/2 top-full pt-5 z-[80]">
            <div class="w-[min(100vw-2rem,960px)] p-6 rounded-2xl bg-white text-neutral-900
                        shadow-xl ring-1 ring-neutral-200 grid grid-cols-4 gap-6">
              <div>
                <h4 class="font-semibold mb-3">12mm (160×320cm)</h4>
                <ul class="space-y-2">
                  <li><a routerLink="/productos/12mm/saint-laurent" class="hover:text-[var(--ts-accent)]">Saint Laurent</a></li>
                  <li><a routerLink="/productos/12mm/black-gold" class="hover:text-[var(--ts-accent)]">Black Gold</a></li>
                </ul>
              </div>
              <div>
                <h4 class="font-semibold mb-3">15mm (160×320cm)</h4>
                <!-- items... -->
              </div>
              <div>
                <h4 class="font-semibold mb-3">20mm (160×320cm)</h4>
                <!-- items... -->
              </div>
              <div class="rounded-xl overflow-hidden bg-neutral-100">
                <img src="/assets/productos/12mm/saint-laurent.jpg" alt="Vista previa" class="w-full h-full object-cover">
              </div>
            </div>
          </div>
        </div>
        
        <!-- Other Navigation Items -->
        <a routerLink="/galeria" 
           routerLinkActive="text-ts-accent"
           class="font-medium hover:text-ts-accent transition-colors px-3 py-2"
           [class.text-white]="!scrolled"
           [class.text-gray-700]="scrolled">
          Galería
        </a>
        <a routerLink="/datos-tecnicos" 
           routerLinkActive="text-ts-accent"
           class="font-medium hover:text-ts-accent transition-colors px-3 py-2"
           [class.text-white]="!scrolled"
           [class.text-gray-700]="scrolled">
          Datos Técnicos
        </a>
        <a routerLink="/contacto" 
           routerLinkActive="text-ts-accent"
           class="font-medium hover:text-ts-accent transition-colors px-3 py-2"
           [class.text-white]="!scrolled"
           [class.text-gray-700]="scrolled">
          Contacto
        </a>
      </div>

      <!-- Actions -->
      <div class="flex items-center gap-4">
        <!-- Cart Button -->
        <button 
          (click)="activarCarrito()"
          class="relative p-2 rounded-lg transition-colors group"
          [class.hover:bg-white/10]="!scrolled"
          [class.hover:bg-gray-100]="scrolled">
          <svg class="w-6 h-6 group-hover:text-ts-accent transition-colors" 
               [class.text-white]="!scrolled"
               [class.text-gray-700]="scrolled"
               fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
          </svg>
          @if (totalItems() > 0) {
            <span class="absolute -top-1 -right-1 w-5 h-5 bg-ts-accent text-white text-xs rounded-full flex items-center justify-center font-medium">
              {{totalItems()}}
            </span>
          }
        </button>
        
        <!-- Mobile Menu Button -->
        <button 
          (click)="alternarMenu()"
          class="lg:hidden p-2 rounded-lg transition-colors"
          [class.hover:bg-white/10]="!scrolled"
          [class.hover:bg-gray-100]="scrolled">
          <svg class="w-6 h-6 transition-colors" 
               [class.text-white]="!scrolled"
               [class.text-gray-700]="scrolled"
               fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    @if (menuAbierto()) {
      <div class="lg:hidden border-t border-gray-100 bg-white/95 backdrop-blur-md">
        <div class="py-4 space-y-2">
          <a routerLink="/" 
             routerLinkActive="bg-ts-accent/10 text-ts-accent" 
             [routerLinkActiveOptions]="{exact: true}"
             (click)="cerrarMenu()"
             class="block px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors font-medium">
            Inicio
          </a>
          <div>
            <button 
              (click)="toggleMobileProductsMenu()"
              class="w-full flex items-center justify-between px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors font-medium">
              Productos
              <svg class="w-4 h-4 transition-transform duration-200" 
                   [class.rotate-180]="mobileProductsOpen"
                   fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            @if (mobileProductsOpen) {
              <div class="ml-4 mt-2 space-y-1">
                <a routerLink="/productos" 
                   (click)="cerrarMenu()"
                   class="block px-4 py-2 text-sm text-gray-600 hover:text-ts-accent transition-colors">
                  Todos los productos
                </a>
                <a routerLink="/productos/12mm" 
                   (click)="cerrarMenu()"
                   class="block px-4 py-2 text-sm text-gray-600 hover:text-ts-accent transition-colors">
                  12mm - Ultrafino
                </a>
                <a routerLink="/productos/15mm" 
                   (click)="cerrarMenu()"
                   class="block px-4 py-2 text-sm text-gray-600 hover:text-ts-accent transition-colors">
                  15mm - Estándar
                </a>
                <a routerLink="/productos/20mm" 
                   (click)="cerrarMenu()"
                   class="block px-4 py-2 text-sm text-gray-600 hover:text-ts-accent transition-colors">
                  20mm - Resistente
                </a>
              </div>
            }
          </div>
          <a routerLink="/galeria" 
             routerLinkActive="bg-ts-accent/10 text-ts-accent"
             (click)="cerrarMenu()"
             class="block px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors font-medium">
            Galería
          </a>
          <a routerLink="/datos-tecnicos" 
             routerLinkActive="bg-ts-accent/10 text-ts-accent"
             (click)="cerrarMenu()"
             class="block px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors font-medium">
            Datos Técnicos
          </a>
          <a routerLink="/contacto" 
             routerLinkActive="bg-ts-accent/10 text-ts-accent"
             (click)="cerrarMenu()"
             class="block px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors font-medium">
            Contacto
          </a>
        </div>
      </div>
    }
  </div>
</nav>
